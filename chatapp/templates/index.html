<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask-SocketIO Example</title>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
        integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+"
        crossorigin="anonymous"></script>
    <style>
        #container {
            display: none;
        }

        #image_container {
            display: none
        }

        #result {
            display: none;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <button id="test_start" class="btn btn-primary">Start Test</button>

    <div class="container mt-5" id="container">
        <div class="text-center">

            <p id="question_text"></p> <br><br>

            <div id="image_container" class="mb-3">
                <img src="" class="img-fluid">
            </div> <br>

            <button id="a_text" class="btn btn-secondary" onclick="check('A');">A</button><br><br>
            <button id="b_text" class="btn btn-secondary" onclick="check('B');">B</button><br><br>
            <button id="c_text" class="btn btn-secondary" onclick="check('C');">C</button><br><br>
            <button id="d_text" class="btn btn-secondary" onclick="check('D');">D</button><br><br>

            <p id="result" class="mt-3"></p>

            <br><br><br>

            <button id="next_q" class="btn btn-primary" onclick="next_question();">Next Question</button>

        </div>
    </div>

    <script>
        const socket = io({ autoConnect: false });

        document.getElementById("test_start").addEventListener("click", function () {

            socket.connect();

            socket.on("connect", function () {
                socket.emit("user_join");
            })

            document.getElementById("test_start").style.display = "none";
            document.getElementById("container").style.display = "block";
        })

        function check(answer) {
            socket.emit("check_answer", answer);
        }

        function next_question() {
            socket.emit("next_question");
        }

        socket.on("get_question", function (data) {
            document.getElementById("result").style.display = "none";
            document.getElementById("a_text").disabled = false;
            document.getElementById("b_text").disabled = false;
            document.getElementById("c_text").disabled = false;
            document.getElementById("d_text").disabled = false;

            document.getElementById("a_text").style = "";
            document.getElementById("b_text").style = "";
            document.getElementById("c_text").style = "";
            document.getElementById("d_text").style = "";

            document.getElementById("question_text").innerText = data.text;

            document.getElementById("a_text").innerText = data.a;
            document.getElementById("b_text").innerText = data.b;
            document.getElementById("c_text").innerText = data.c;
            document.getElementById("d_text").innerText = data.d;

        })

        socket.on("check_complete", function (data) {
            document.getElementById("result").style.display = "block";
            document.getElementById("a_text").disabled = true;
            document.getElementById("b_text").disabled = true;
            document.getElementById("c_text").disabled = true;
            document.getElementById("d_text").disabled = true;

            a = {"A": "a_text", "B": "b_text", "C": "c_text", "D": "d_text"}

            if (data.res) {
                document.getElementById("result").innerText = "Correct";
                document.getElementById(a[data.cor_res]).style = "background: green";
            } else {
                document.getElementById("result").innerText = "Несorrect!!! Учись дальше!";
            }
            console.log(data);
        })
    </script>
</body>

</html>